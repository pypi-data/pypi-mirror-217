- set_fact:
    test_dict: "{{test_dict|default({})|combine({'nnrt':'OK'})}}"

- name: test if nnrt installed
  find:
    paths:
      - "{{ ascend_install_path }}/nnrt"
    recurse: yes
    file_type: file
    use_regex: yes
    patterns: "ascend_nnrt_install.info"
  register: nnrt

- name: message
  debug:
    msg:
    - "nnrt not installed, please install first"
  when: nnrt.matched == 0

- set_fact:
    test_dict: "{{test_dict|default({})|combine({'nnrt':'not installed'})}}"
  when: nnrt.matched == 0

- name: set the environment script
  command: "bash {{ ascend_install_path }}/nnrt/set_env.sh"
  ignore_errors: true
  when: nnrt.matched > 0

- name: check if function well
  command: "{{ discovered_interpreter_python }} -c 'import acl'"
  register: nnrt
  when: nnrt.matched > 0
  ignore_errors: true
  retries: 3

- set_fact:
    test_dict: "{{test_dict|default({})|combine({'nnrt':'ERROR'})}}"
  when: nnrt.rc != 0