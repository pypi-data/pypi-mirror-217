"use strict";(self.webpackChunkinhpc_dm=self.webpackChunkinhpc_dm||[]).push([[153],{153:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var n=i(638),o=i(303),s=i(299),a=i(931),l=i(20),r=i(139),d=i(918),c=i(832),h=i(122);class _ extends h.FileBrowser{constructor(t,e){super(t),this.title.label=e}getListing(){return this.listing}getSelectedDirectory(){var t=this.listing.model.path,e=this.listing.selectedItems().next();return e&&"directory"==e.type&&(t=e.path),t}getCurrentPath(){return this.listing.model.path}}var p=i(745),u=i(344);async function m(t="",e={}){const i=r.ServerConnection.makeSettings(),n=u.URLExt.join(i.baseUrl,"inhpc_dm",t);let o;try{o=await r.ServerConnection.makeRequest(n,e,i)}catch(t){if(t instanceof Error)throw new r.ServerConnection.NetworkError(t);{let t;throw t=new TypeError("Serverside was not available, something went wrong"),console.log("Serverside was not available, something went wrong"),new r.ServerConnection.NetworkError(t)}}if(!o.ok){let t;t=o.statusText;try{t+=JSON.stringify(await o.json())}catch(t){}throw new r.ServerConnection.ResponseError(o,t)}return await o.json()}class g extends c.Widget{constructor(t=[],e="",i){super(),this.addClass("jp-Input-Dialog"),this._list=document.createElement("select");let n="";null!=i&&(n=i),t.forEach(((t,e)=>{const i=document.createElement("option");i.value=t,i.textContent=t,this._list.appendChild(i)}));const o=document.createElement("datalist");o.id="input-dialog-items",o.appendChild(this._list),this._input_endpoint=document.createElement("input"),this._input_endpoint.classList.add("jp-mod-styled"),this._input_endpoint.id="jp-dialog-input-id_ep",this._input_endpoint.type="list",this._input_endpoint.value=n,this._input_endpoint.setAttribute("list",o.id),this.node.appendChild(o);const s=document.createElement("label");s.textContent="UFTP endpoint",s.htmlFor=this._input_endpoint.id,this.node.appendChild(s),this.node.appendChild(this._input_endpoint),this._input_remoteDir=document.createElement("input"),this._input_remoteDir.classList.add("jp-mod-styled"),this._input_remoteDir.id="jp-dialog-input-id_rd";const a=document.createElement("label");a.textContent="Remote directory",a.htmlFor=this._input_remoteDir.id,this.node.appendChild(a),this.node.appendChild(this._input_remoteDir),this._input_localDir=document.createElement("input"),this._input_localDir.classList.add("jp-mod-styled"),this._input_localDir.id="jp-dialog-input-id_ld",this._input_localDir.value=e;const l=document.createElement("label");l.textContent="Mount point",l.htmlFor=this._input_localDir.id,this.node.appendChild(l),this.node.appendChild(this._input_localDir),this._input_username=document.createElement("input"),this._input_username.classList.add("jp-mod-styled"),this._input_username.id="jp-dialog-input-id_un";const r=document.createElement("label");r.textContent="Username",r.htmlFor=this._input_username.id,this.node.appendChild(r),this.node.appendChild(this._input_username),this._input_password=document.createElement("input"),this._input_password.classList.add("jp-mod-styled"),this._input_password.type="password",this._input_password.id="jp-dialog-input-id_pw";const d=document.createElement("label");d.textContent="Password",d.htmlFor=this._input_password.id,this.node.appendChild(d),this.node.appendChild(this._input_password),this._input_token=document.createElement("input"),this._input_token.classList.add("jp-mod-styled"),this._input_token.id="jp-dialog-input-id_tok";const c=document.createElement("label");c.textContent="OAuth token",c.htmlFor=this._input_token.id,this.node.appendChild(c),this.node.appendChild(this._input_token),this._input_identity=document.createElement("input"),this._input_identity.classList.add("jp-mod-styled"),this._input_identity.id="jp-dialog-input-id_identity";const h=document.createElement("label");h.textContent="Path to private key",h.htmlFor=this._input_identity.id,this.node.appendChild(h),this.node.appendChild(this._input_identity)}getValue(){return{endpoint:this._input_endpoint.value,remote_directory:this._input_remoteDir.value,mount_point:this._input_localDir.value,credentials:{username:this._input_username.value,password:this._input_password.value,token:this._input_token.value,identity:this._input_identity.value}}}}class f extends o.ToolbarButton{constructor(t,e,i){super({icon:p.addIcon,tooltip:"Mount remote filesystem via UFTP",onClick:()=>{this.handle_click(t,e,i)}})}handle_click(t,e,i){console.log(this),function(t,e,i){return function(t={}){return new o.Dialog(t).launch()}({body:new g(t,e,i),buttons:[o.Dialog.cancelButton({label:"Cancel"}),o.Dialog.okButton({label:"OK"})],focusNodeSelector:"input"})}(e,t.getSelectedDirectory(),i).then((async e=>{var i=JSON.stringify(e.value);if("null"!=i){var n=JSON.parse(i).mount_point;console.log("Mount dir: "+n),console.log("mount params: "+i);try{const e=await m("mount",{body:i,method:"POST"});console.log(e),"OK"==e.status?((0,o.showDialog)({title:"OK",body:"Mount successful",buttons:[o.Dialog.okButton()]}),await t.getListing().model.cd("/"),await t.getListing().model.cd(n)):(0,o.showErrorMessage)("Error",e.error_info)}catch(t){console.error(`Error on POST /inhpc_dm/mount".\n${t}`),(0,o.showErrorMessage)("Error",t)}}else console.log("Mount cancelled")}))}}class b extends o.ToolbarButton{constructor(t){super({icon:p.clearIcon,tooltip:"Unmount remote filesystem",onClick:()=>{this.handle_click(t)}})}async handle_click(t){console.log(this);var e=t.getSelectedDirectory(),i=JSON.stringify({mount_point:e});console.log("mount params: "+i);try{const t=await m("unmount",{body:i,method:"POST"});console.log(t),"OK"==t.status?(0,o.showDialog)({title:"OK",body:"Unmount successful",buttons:[o.Dialog.okButton()]}):(0,o.showErrorMessage)("Error",t.error_info)}catch(t){console.error(`Error on POST /inhpc_dm/unmount".\n${t}`),(0,o.showErrorMessage)("Error",t)}}}class w extends o.ToolbarButton{constructor(t,e,i,n){super({label:i,tooltip:n,onClick:()=>{this.handle_click(t,e)}})}async handle_click(t,e){var i=e.getSelectedDirectory(),n=[];(0,d.each)(t.getListing().selectedItems(),(t=>{n.push(t.path)}));var s=JSON.stringify({command:"copy",parameters:{target:i,sources:n}});console.log("Copy command params: "+s);try{const t=await m("tasks",{body:s,method:"POST"});console.log(t),"OK"==t.status?(0,o.showDialog)({title:"OK",body:"Task launched successfully",buttons:[o.Dialog.okButton()]}):(0,o.showErrorMessage)("Error",t.error_info)}catch(t){console.error(`Error on POST /inhpc_dm/tasks".\n${t}`),(0,o.showErrorMessage)("Error",t)}}}class y extends c.Widget{static createNode(){let t=document.createElement("div"),e=document.createElement("div"),i=document.createElement("textarea");return i.placeholder="Placeholder...",e.appendChild(i),t.appendChild(e),t}constructor(t){super({node:y.createNode()}),this.setFlag(c.Widget.Flag.DisallowLayout),this.addClass("content"),this.addClass(t.toLowerCase()),this.title.label=t,this.title.closable=!0,this.title.caption=`Long description for: ${t}`}get textareaNode(){return this.node.getElementsByTagName("textarea")[0]}onActivateRequest(t){this.isAttached&&this.textareaNode.focus()}}class C extends c.Widget{constructor(t){super(),this._settings={uftp_endpoints:["https://localhost:9000/rest/auth/TEST","https://gridftp-fr1.hww.hlrs.de:9000/rest/auth/HLRS","https://uftp.fz-juelich.de:9112/UFTP_Auth/rest/auth/JUDAC","https://datagw03.supermuc.lrz.de:9000/rest/auth/DATAGW"]},this.addClass("my-dmWidget");let e=new l.DocumentRegistry;const i=new r.ServiceManager;let n=new a.DocumentManager({registry:e,manager:i,opener}),o=new h.FilterFileBrowserModel({manager:n});this._fbWidget_l=new _({id:"filebrowser-left",model:o},"Filebrowser left");const s=new f(this._fbWidget_l,this._settings.uftp_endpoints);this._fbWidget_l.toolbar.addItem("mountBtn",s);const d=new b(this._fbWidget_l);this._fbWidget_l.toolbar.addItem("unmountBtn",d),this._infoWidget_l=new y("Info"),this._infoWidget_l.id="infoWidget_l",this._infoWidget_l.textareaNode.value="<n/a>",this._infoWidget_l.textareaNode.style.width="95%",this._fbPanel_l=new c.SplitPanel({orientation:"vertical",spacing:1}),this._fbPanel_l.id="fb_panel_l",this._fbPanel_l.addWidget(this._fbWidget_l),this._fbPanel_l.addWidget(this._infoWidget_l),this._fbPanel_l.setRelativeSizes([90,10]);let p=new h.FilterFileBrowserModel({manager:n});this._fbWidget_r=new _({id:"filebrowser-right",model:p},"Filebrowser right");const u=new f(this._fbWidget_r,this._settings.uftp_endpoints,this._defaultEndpoint);this._fbWidget_r.toolbar.addItem("mountBtn",u);const m=new b(this._fbWidget_r);this._fbWidget_r.toolbar.addItem("unmountBtn",m),this._infoWidget_r=new y("Info"),this._infoWidget_r.id="infoWidget_r",this._infoWidget_r.textareaNode.value="<n/a>",this._infoWidget_r.textareaNode.style.width="95%",this._fbPanel_r=new c.SplitPanel({orientation:"vertical",spacing:1}),this._fbPanel_r.id="fb_panel_r",this._fbPanel_r.addWidget(this._fbWidget_r),this._fbPanel_r.addWidget(this._infoWidget_r),this._fbPanel_r.setRelativeSizes([90,10]);const g=new w(this._fbWidget_l,this._fbWidget_r,"--\x3e","Copy left selected to right directory directly"),C=new w(this._fbWidget_r,this._fbWidget_l,"<--","Copy right selected to left directory directly");this._transferBoxPanel=new c.BoxPanel({direction:"top-to-bottom"}),this._transferBoxPanel.id="transferToolbar",this._transferBoxPanel.node.style.maxWidth="100px",this._transferBoxPanel.node.style.maxHeight="100px",this._transferBoxPanel.node.style.top="200px",this._transferBoxPanel.addWidget(g),this._transferBoxPanel.addWidget(C),this._fbPanel=new c.BoxPanel({direction:"left-to-right",spacing:1}),this._fbPanel.id="fb_panel",this._fbPanel.addClass("dm_Widget-main"),this._fbPanel.addWidget(this._fbPanel_l),this._fbPanel.addWidget(this._transferBoxPanel),this._fbPanel.addWidget(this._fbPanel_r),this._mainLayout=this.layout=new c.BoxLayout,this._panel_collection=new c.SplitPanel({orientation:"vertical"}),this._panel_collection.id="panel_collection",this._panel_collection.addWidget(this._fbPanel),this._panel_collection.setRelativeSizes([10,80,10]),this._mainLayout.addWidget(this._panel_collection)}formatBytes(t,e=2){if(0===t)return"0 Bytes";const i=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(i))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}print_object_details(t){console.log("Print Object Details"),console.log(Object.getOwnPropertyNames(t).sort())}eventSignalHandler(t,e){if("DirListing"===t.constructor.name)if("click"===e){var i="Selected Files Info",n=0;(0,d.each)(this._fbWidget_l.getListing().selectedItems(),(t=>{t.size&&(n+=t.size),t.size&&(i=i+"\n"+t.path+"("+this.formatBytes(t.size)+")")})),i=i+"\nOverall Size: "+this.formatBytes(n),i="Selected Files Info",n=0,(0,d.each)(this._fbWidget_r.getListing().selectedItems(),(t=>{t.size&&(n+=t.size),t.size&&(i=i+"\n"+t.path+"("+this.formatBytes(t.size)+")")})),i=i+"\nOverall Size: "+this.formatBytes(n)}else console.log("Unknown in DirListing: ",e);else console.log("Unknown event sender: ",t.constructor.name)}setDefaultEndpoint(t){this._defaultEndpoint=t}}const P={id:"@jupyterlab/inhpc-extension:plugin",autoStart:!0,requires:[o.ICommandPalette,n.ILayoutRestorer,s.ISettingRegistry],activate:(t,e,i,n)=>{!function(t,e,i,n,s){let a;console.log("JupyterLab extension InHPC data management activating.");const l="inhpc:opendm",r=new C(t);t.commands.addCommand(l,{label:"InHPC - Data Management dual browser view",execute:()=>{a&&!a.isDisposed||(r.id="dmwidget_id",a=new o.MainAreaWidget({content:r}),a.id="inhpc-datamanagement",a.title.label="Data Management",a.title.closable=!0),d.has(a)||d.add(a),a.isAttached||t.shell.add(a,"main"),a.content.update(),t.shell.activateById(a.id)}}),e.addItem({command:l,category:"Tutorial"});let d=new o.WidgetTracker({namespace:"inhpc_dm"});function c(t){let e;e=t.get("defaultHost").composite.toString(),console.log("Settings are: "+e),r.setDefaultEndpoint(e)}i.restore(d,{command:l,name:()=>"inhpc_dm"}),Promise.all([n.load(s),t.started]).then((([t])=>{console.log("entering the promis, loading the settings "),c(t),t.changed.connect((()=>{c(t)}))})).catch((t=>{console.error("Problem with Settings: "+t.message)}))}(t,e,i,n,P.id)}},v=P}}]);