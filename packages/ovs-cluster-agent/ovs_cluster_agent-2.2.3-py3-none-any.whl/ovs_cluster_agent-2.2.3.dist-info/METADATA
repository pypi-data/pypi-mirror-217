Metadata-Version: 2.1
Name: ovs-cluster-agent
Version: 2.2.3
Summary: Cluster API data aggregator
Home-page: https://github.com/omnivector-solutions/ovs-cluster-agent/
Author: omnivector-solutions
Author-email: info@omnivector.solutions
License: MIT
Download-URL: https://github.com/omnivector-solutions/ovs-cluster-agent/dist/cluster-agent-2.2.3tar.gz
Keywords: armada,hpc
Platform: UNKNOWN
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Information Technology
Classifier: Intended Audience :: System Administrators
Classifier: Intended Audience :: Other Audience
Classifier: Topic :: Software Development
Classifier: Topic :: Internet
Classifier: Topic :: Internet :: WWW/HTTP :: HTTP Servers
Classifier: Topic :: Utilities
Classifier: License :: Other/Proprietary License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Operating System :: OS Independent
Description-Content-Type: text/markdown
Requires-Dist: boto3 (==1.17.8)
Requires-Dist: Codado (==0.8.0)
Requires-Dist: click (==8.0.1)
Requires-Dist: pydantic (==1.8.2)
Requires-Dist: python-dotenv (==0.16.0)
Requires-Dist: toml (==0.10.2)
Requires-Dist: sentry-sdk (~=1.1.0)
Requires-Dist: python-hostlist (==1.21)
Requires-Dist: loguru (==0.6.0)
Requires-Dist: httpx (==0.23.0)
Requires-Dist: py-buzz (==3.1.0)
Requires-Dist: ldap3 (==2.9.1)
Requires-Dist: python-jose (==3.3.0)
Requires-Dist: timeoutcontext (==1.2.0)
Provides-Extra: dev
Requires-Dist: pytest (==7.1.0) ; extra == 'dev'
Requires-Dist: pytest-mock (==3.7.0) ; extra == 'dev'
Requires-Dist: respx (==0.19.2) ; extra == 'dev'
Requires-Dist: asynctest (==0.13.0) ; extra == 'dev'
Requires-Dist: pytest-asyncio (==0.18.2) ; extra == 'dev'
Requires-Dist: black (==22.3.0) ; extra == 'dev'
Requires-Dist: flake8 (==4.0.1) ; extra == 'dev'
Requires-Dist: pytest-env (==0.6.2) ; extra == 'dev'
Requires-Dist: pytest-random-order (==1.0.4) ; extra == 'dev'
Requires-Dist: pytest-cov (==3.0.0) ; extra == 'dev'
Requires-Dist: freezegun (==1.2.2) ; extra == 'dev'

# cluster-agent

# Table of contents

- [Project setup](#project-setup)
  - [Dependencies](#dependencies)
- [Install the package](#install-the-package)
- [Setup parameters](#setup-parameters)
- [Local usage example](#local-usage-exemple)

## Project Setup

### Dependencies

* python3-venv

## Install the package

To install the package from Pypi simply run `pip install ovs-cluster-agent`.

## Setup parameters

1. Setup dependencies
  You can use whenever dependency manager you want to. Just run the command below (and the ones following) on behalf of the manager you prefer.

  ```bash
  make dependencies
  ```

2. Setup `.env` parameters
  ```bash
  CLUSTER_AGENT_BASE_API_URL="<base-api-url>"
  CLUSTER_AGENT_BASE_SLURMRESTD_URL="<slurmrestd-endpoint>"
  CLUSTER_AGENT_X_SLURM_USER_NAME="<slurmrestd-user-name>"
  CLUSTER_AGENT_SLURMRESTD_JWT_KEY_PATH="/path/to/the/jwt/secret/key"
  CLUSTER_AGENT_SLURMRESTD_JWT_KEY_STRING="jwt-secret-key-in-plain-text"
  CLUSTER_AGENT_SENTRY_DSN="<sentry-dsn-key>"
  CLUSTER_AGENT_OIDC_DOMAIN="<OIDC-domain>"
  CLUSTER_AGENT_OIDC_AUDIENCE="<OIDC-audience>"
  CLUSTER_AGENT_OIDC_CLIENT_ID="<OIDC-app-client-id>"
  CLUSTER_AGENT_OIDC_CLIENT_SECRET="<OIDC-app-client-secret>"
  CLUSTER_AGENT_LDAP_HOST="<hostname-for-ldap>"
  CLUSTER_AGENT_LDAP_DOMAIN="<LDAP-domain>" # Defaults to match LDAP_HOST
  CLUSTER_AGENT_LDAP_USERNAME="<admin-user>"
  CLUSTER_AGENT_LDAP_PASSWORD="<admin-password>"
  ```

  NOTE: `CLUSTER_AGENT_SENTRY_DSN` is optional. If you do not pass it the agent understands Sentry will not be used.

  NOTE: When both `CLUSTER_AGENT_SLURMRESTD_JWT_KEY_PATH` and `CLUSTER_AGENT_SLURMRESTD_JWT_KEY_STRING` are passed, the agent will completely ignore the `CLUSTER_AGENT_SLURMRESTD_JWT_KEY_PATH` and will prioritize the `CLUSTER_AGENT_SLURMRESTD_JWT_KEY_STRING`. Beware this behaviour.

## Local usage example

1. Run app
  ```bash
  agentrun
  ```

**Note**: this command assumes you're inside a virtual environment in which the package is installed.

**NOTE**: beware you should care about having the same user name you're using to run the code in the slurmctld node. For example, if `cluster_agent` will run the `make run` command then the slurmctld node also must have a user called `cluster_agent`.


