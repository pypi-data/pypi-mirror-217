# Copyright 2021-2023 NXP
#
# SPDX-License-Identifier: BSD-3-Clause

certificate_v2:
  type: object
  title: Certificate V2 Settings
  properties:
    imageBuildNumber:
      type: [number, string]
      title: Image Build Number
      description: If it's omitted, it will be used 0 as default value.
      format: number
      template_value: 0

    chainCertificate0File0:
      type: string
      title: Chain certificate 0 for root 0
      description: Chain certificate 0 for root certificate 0
      format: optional_file
      template_value: chain_certificate0_depth0.pem
    chainCertificate0File1:
      type: string
      title: Chain certificate 1 for root 0
      description: Chain certificate 1 for root certificate 0
      format: optional_file
      template_value: chain_certificate0_depth1.pem
    chainCertificate0File2:
      type: string
      title: Chain certificate 2 for root 0
      description: Chain certificate 2 for root certificate 0
      format: optional_file
      template_value: chain_certificate0_depth2.pem
    chainCertificate0File3:
      type: string
      title: Chain certificate 3 for root 0
      description: Chain certificate 3 for root certificate 0
      format: optional_file
      template_value: chain_certificate0_depth3.pem

    chainCertificate1File0:
      type: string
      title: Chain certificate 0 for root 1
      description: Chain certificate 0 for root certificate 1
      format: optional_file
      template_value: chain_certificate1_depth0.pem
    chainCertificate1File1:
      type: string
      title: Chain certificate 1 for root 1
      description: Chain certificate 1 for root certificate 1
      format: optional_file
      template_value: chain_certificate1_depth1.pem
    chainCertificate1File2:
      type: string
      title: Chain certificate 2 for root 1
      description: Chain certificate 2 for root certificate 1
      format: optional_file
      template_value: chain_certificate1_depth2.pem
    chainCertificate1File3:
      type: string
      title: Chain certificate 3 for root 1
      description: Chain certificate 3 for root certificate 1
      format: optional_file
      template_value: chain_certificate1_depth3.pem

    chainCertificate2File0:
      type: string
      title: Chain certificate 0 for root 2
      description: Chain certificate 0 for root certificate 2
      format: optional_file
      template_value: chain_certificate2_depth0.pem
    chainCertificate2File1:
      type: string
      title: Chain certificate 1 for root 2
      description: Chain certificate 1 for root certificate 2
      format: optional_file
      template_value: chain_certificate2_depth1.pem
    chainCertificate2File2:
      type: string
      title: Chain certificate 2 for root 2
      description: Chain certificate 2 for root certificate 2
      format: optional_file
      template_value: chain_certificate2_depth2.pem
    chainCertificate2File3:
      type: string
      title: Chain certificate 3 for root 2
      description: Chain certificate 3 for root certificate 2
      format: optional_file
      template_value: chain_certificate2_depth3.pem

    chainCertificate3File0:
      type: string
      title: Chain certificate 0 for root 3
      description: Chain certificate 0 for root certificate 3
      format: optional_file
      template_value: chain_certificate3_depth0.pem
    chainCertificate3File1:
      type: string
      title: Chain certificate 1 for root 3
      description: Chain certificate 1 for root certificate 3
      format: optional_file
      template_value: chain_certificate3_depth1.pem
    chainCertificate3File2:
      type: string
      title: Chain certificate 2 for root 3
      description: Chain certificate 2 for root certificate 3
      format: optional_file
      template_value: chain_certificate3_depth2.pem
    chainCertificate3File3:
      type: string
      title: Chain certificate 3 for root 3
      description: Chain certificate 3 for root certificate 3
      format: optional_file
      template_value: chain_certificate3_depth3.pem


certificate_v31:
  type: object
  title: ISK Certificate Settings
  properties:
    binaryCertificateBlock:
      type: string
      title: Binary Certificate
      description: Optionally the certificate could be defined as a pre-generated binary block.
        In case that is defined, all other configuration for certification block must be deleted ('useIsk', 'mainRootCertPrivateKeyFile', 'signingCertificateFile', 'signingCertificateConstraint', 'signCertData')
        In case that ISK is defined, certicate block must be deleted
      format: file
      template_value: my_isk_cert.bin
    useIsk:
      type: boolean
      title: Use ISK for signature certification
      description: Enable ISK type of signature certification. Don't use when 'binaryCertificateBlock' is defined
      template_value: false
    mainRootCertPrivateKeyFile:
      type: string
      title: Main root Certification Private Key
      description: Path to Main root Certification Private Key. Don't use when 'binaryCertificateBlock' is defined
      format: file
      template_value: main_cert_prv_key.pem
    signingCertificateFile:
      type: string
      title: Signing Certificate
      description: Path to Signing Certificate. Don't use when 'binaryCertificateBlock' is defined
      format: file
      template_value: sign_cert.pem
    signingCertificateConstraint:
      type: [string, number]
      title: Signing certificate constrain
      description: Signing certificate constrain number. Don't use when 'binaryCertificateBlock' is defined
      format: number
      default: 0
      template_value: 0
    signCertData:
      type: string
      title: Signing Certificate data
      description: Path to Signing Certificate data. Don't use when 'binaryCertificateBlock' is defined
      format: optional_file
      template_value: sign_cert.bin
    signingCertificatePrivateKeyFile:
      id: "#signingCertificatePrivateKeyFile"
      type: string
      title: ISK Certificate private key
      description: ISK Certificate private key used to sign certificate. It can be replaced by signProvider key.
      format: file
      template_value: isk_prv_key.pem
    iskSignProvider:
      type: string
      title: ISK Signature Provider
      description: Signature provider configuration in format 'type=<sp_type>;<key1>=<value1>;<key2>=<value2>".
      template_value: type=file;file_path=my_isk_prv_key.pem

  allOf: # Global all of group - this is main concatenation group for all sub rules
    - oneOf:
        - required: [binaryCertificateBlock]
        - required: [useIsk]
          if:
            properties:
              useIsk:
                const: True
          then:
            required: [signingCertificateFile]
            oneOf:
              - allOf:
                - required: [mainRootCertPrivateKeyFile]
                - not:
                    required: [signProvider]
              - allOf:
                - required: [signProvider]
                - not:
                    required: [mainRootCertPrivateKeyFile]


cert_block_output:
  type: object
  title: Basic Settings
  properties:
    containerOutputFile:
      type: string
      title: cert block filename
      description: Generated cert block filename.
      template_value: cert_block.bin
  required: [cert_block_output]

certificate_root_keys:
  type: object
  title: Root Keys Settings
  properties:
    rootCertificate0File:
      type: string
      title: Root Certificate File 0
      description: Root certificate file index 0.
      format: file
      template_value: my_certificate0.pub
    rootCertificate1File:
      type: string
      title: Root Certificate File 1
      description: Root certificate file index 1.
      format: optional_file
      template_value: my_certificate1.pub
    rootCertificate2File:
      type: string
      title: Root Certificate File 2
      description: Root certificate file index 2.
      format: optional_file
      template_value: my_certificate2.pub
    rootCertificate3File:
      type: string
      title: Root Certificate File 3
      description: Root certificate file index 3.
      format: optional_file
      template_value: my_certificate3.pub

    mainRootCertId:
      type: [number, string]
      title: Main Certificate Index
      description: Index of certificate that is used as a main. If not defined, the certificate matching private key will be selected.
      format: number
      template_value: 0

    mainCertChainId:
      type: [number, string]
      title: Main Certificate Chain Index
      description: Caution! This property is kept here for backwards compatibility with old schemas. Use mainRootCertId instead.
      format: number
      skip_in_template: true

  allOf: # Global all of group - this is main concatenation group for all sub rules
    - oneOf:
      - required: [binaryCertificateBlock]
      - allOf:
        - required: [rootCertificate0File]
        - anyOf:
          - allOf:
              - required: [mainCertPrivateKeyFile]
              - not:
                  required: [signProvider]
          - allOf:
              - required: [signProvider]
              - not:
                  required: [mainCertPrivateKeyFile]
          - anyOf:
            - required: [mainRootCertId]
            - required: [mainCertChainId]


