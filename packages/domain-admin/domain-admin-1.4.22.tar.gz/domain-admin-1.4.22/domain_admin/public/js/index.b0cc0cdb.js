import{_ as q}from"./index.f21df8b3.js";import{ah as L,o as w,c as N,V as g,P as d,a as O,U as _,O as E,T,ar as F,Q as U}from"./vendor-vue.edbe275b.js";import"./element-icon.ade3aa7e.js";import"./vendor-lib.aab05a6a.js";import"./element-plus.83d58e84.js";const W={name:"",components:{},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(n){this.currentRow=n,this.dialogVisible=!0},async handleDeleteClick(n){let e={id:n.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleStatusChange(n){let e={id:n.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},handleUpdateSuccess(){this.$emit("on-success")}},created(){}},M={key:3},H=["innerHTML"];function Q(n,e,t,i,r,o){const a=L("el-table-column"),l=L("el-tag"),u=L("el-table");return w(),N("div",null,[g(u,{data:t.list,stripe:"",border:""},{default:d(()=>[g(a,{label:"\u64CD\u4F5C\u4EBA","header-align":"center",align:"center",width:"100",prop:"user_name","show-overflow-tooltip":""},{default:d(s=>[O("span",null,_(s.row.user_name||"-"),1)]),_:1}),g(a,{label:"\u64CD\u4F5C\u8868",width:"120","header-align":"center",align:"center",prop:"table","show-overflow-tooltip":""},{default:d(s=>[O("span",null,_(s.row.table||"-"),1)]),_:1}),g(a,{label:"\u64CD\u4F5C\u7C7B\u578B","header-align":"center",align:"center",prop:"type_id",width:"100"},{default:d(s=>[s.row.type_id==2?(w(),E(l,{key:0},{default:d(()=>[T(_(s.row.type_label),1)]),_:2},1024)):s.row.type_id==1?(w(),E(l,{key:1,type:"success"},{default:d(()=>[T(_(s.row.type_label),1)]),_:2},1024)):s.row.type_id==3||s.row.type_id==4?(w(),E(l,{key:2,type:"danger"},{default:d(()=>[T(_(s.row.type_label),1)]),_:2},1024)):(w(),N("span",M,"-"))]),_:1}),g(a,{label:"\u6570\u636E\u53D8\u5316","header-align":"center",align:"left",prop:"type_id"},{default:d(s=>[O("pre",{class:"code",innerHTML:s.row.data},null,8,H)]),_:1}),g(a,{label:"\u64CD\u4F5C\u65F6\u95F4","header-align":"center",align:"center",prop:"create_time",width:"100"},{default:d(s=>[O("span",null,_(s.row.create_time_label||"-"),1)]),_:1})]),_:1},8,["data"])])}const Z=q(W,[["render",Q]]);function v(){}v.prototype={diff:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.callback;typeof i=="function"&&(r=i,i={}),this.options=i;var o=this;function a(f){return r?(setTimeout(function(){r(void 0,f)},0),!0):f}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,u=e.length,s=1,h=l+u;i.maxEditLength&&(h=Math.min(h,i.maxEditLength));var c=[{newPos:-1,components:[]}],y=this.extractCommon(c[0],t,e,0);if(c[0].newPos+1>=l&&y+1>=u)return a([{value:this.join(t),count:t.length}]);function z(){for(var f=-1*s;f<=s;f+=2){var p=void 0,C=c[f-1],D=c[f+1],x=(D?D.newPos:0)-f;C&&(c[f-1]=void 0);var R=C&&C.newPos+1<l,V=D&&0<=x&&x<u;if(!R&&!V){c[f]=void 0;continue}if(!R||V&&C.newPos<D.newPos?(p=X(D),o.pushComponent(p.components,void 0,!0)):(p=C,p.newPos++,o.pushComponent(p.components,!0,void 0)),x=o.extractCommon(p,t,e,f),p.newPos+1>=l&&x+1>=u)return a(G(o,p.components,t,e,o.useLongestToken));c[f]=p}s++}if(r)(function f(){setTimeout(function(){if(s>h)return r();z()||f()},0)})();else for(;s<=h;){var b=z();if(b)return b}},pushComponent:function(e,t,i){var r=e[e.length-1];r&&r.added===t&&r.removed===i?e[e.length-1]={count:r.count+1,added:t,removed:i}:e.push({count:1,added:t,removed:i})},extractCommon:function(e,t,i,r){for(var o=t.length,a=i.length,l=e.newPos,u=l-r,s=0;l+1<o&&u+1<a&&this.equals(t[l+1],i[u+1]);)l++,u++,s++;return s&&e.components.push({count:s}),e.newPos=l,u},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function G(n,e,t,i,r){for(var o=0,a=e.length,l=0,u=0;o<a;o++){var s=e[o];if(s.removed){if(s.value=n.join(i.slice(u,u+s.count)),u+=s.count,o&&e[o-1].added){var c=e[o-1];e[o-1]=e[o],e[o]=c}}else{if(!s.added&&r){var h=t.slice(l,l+s.count);h=h.map(function(z,b){var f=i[u+b];return f.length>z.length?f:z}),s.value=n.join(h)}else s.value=n.join(t.slice(l,l+s.count));l+=s.count,s.added||(u+=s.count)}}var y=e[a-1];return a>1&&typeof y.value=="string"&&(y.added||y.removed)&&n.equals("",y.value)&&(e[a-2].value+=y.value,e.pop()),e}function X(n){return{newPos:n.newPos,components:n.components.slice(0)}}var I=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,J=/\S/,A=new v;A.equals=function(n,e){return this.options.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n===e||this.options.ignoreWhitespace&&!J.test(n)&&!J.test(e)};A.tokenize=function(n){for(var e=n.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&I.test(e[t])&&I.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};var B=new v;B.tokenize=function(n){var e=[],t=n.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var i=0;i<t.length;i++){var r=t[i];i%2&&!this.options.newlineIsToken?e[e.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),e.push(r))}return e};var Y=new v;Y.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var j=new v;j.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function $(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$=function(e){return typeof e}:$=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(n)}var K=Object.prototype.toString,m=new v;m.useLongestToken=!0;m.tokenize=B.tokenize;m.castInput=function(n){var e=this.options,t=e.undefinedReplacement,i=e.stringifyReplacer,r=i===void 0?function(o,a){return typeof a>"u"?t:a}:i;return typeof n=="string"?n:JSON.stringify(S(n,null,null,r),r,"  ")};m.equals=function(n,e){return v.prototype.equals.call(m,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function P(n,e,t){return m.diff(n,e,t)}function S(n,e,t,i,r){e=e||[],t=t||[],i&&(n=i(r,n));var o;for(o=0;o<e.length;o+=1)if(e[o]===n)return t[o];var a;if(K.call(n)==="[object Array]"){for(e.push(n),a=new Array(n.length),t.push(a),o=0;o<n.length;o+=1)a[o]=S(n[o],e,t,i,r);return e.pop(),t.pop(),a}if(n&&n.toJSON&&(n=n.toJSON()),$(n)==="object"&&n!==null){e.push(n),a={},t.push(a);var l=[],u;for(u in n)n.hasOwnProperty(u)&&l.push(u);for(l.sort(),o=0;o<l.length;o+=1)u=l[o],a[u]=S(n[u],e,t,i,u);e.pop(),t.pop()}else a=n;return a}var k=new v;k.tokenize=function(n){return n.slice()};k.join=k.removeEmpty=function(n){return n};const ee={name:"log_operation-list",props:{},components:{DataTable:Z},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1,pageSizeCachekey:"pageSize"}},computed:{},methods:{resetData(){this.page=1,this.list=[],this.getData()},async getData(){this.loading=!0;let n={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getOperationLogList(n);e.code==0&&(this.list=e.data.list.map(t=>{try{t.before=JSON.parse(t.before)}catch{}try{t.after=JSON.parse(t.after)}catch{}if(t.type_id==2){let i=P(t.before,t.after);console.log(i);let r=[];i.forEach(o=>{console.log(o),o.added?r.push('<div class="added">'+o.value+"</div>"):o.removed?r.push('<div class="removed">'+o.value+"</div>"):r.push("<div>"+o.value+"</div>")}),t.data=r.join("")}else t.type_id==1?t.data=JSON.stringify(t.after,null,2):(t.type_id==3||t.type_id==4)&&(t.data=JSON.stringify(t.before,null,2));return t}),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},getObjectString(n){let e=[];for(let[t,i]of Object.entries(n))e.push(`${t}: ${i}`);return e.join(`
`)},handleSearch(){this.resetData()},handleSizeChange(n){localStorage.setItem(this.pageSizeCachekey,n),this.resetData()},loadPageSize(){let n=localStorage.getItem(this.pageSizeCachekey);n&&(this.size=parseInt(n))}},created(){this.loadPageSize(),this.getData()}},te={class:"app-container"};function ne(n,e,t,i,r,o){const a=L("DataTable"),l=L("el-pagination"),u=F("loading");return w(),N("div",te,[U(g(a,{class:"mt-md",list:r.list,onOnSuccess:o.resetData,onOnEditRow:n.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[u,r.loading]]),g(l,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:r.total,"page-size":r.size,"onUpdate:pageSize":e[0]||(e[0]=s=>r.size=s),"current-page":r.page,"onUpdate:currentPage":e[1]||(e[1]=s=>r.page=s),onCurrentChange:o.getData,onSizeChange:o.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])}const le=q(ee,[["render",ne]]);export{le as default};
