"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[142],{8980:function(e,t,n){n.d(t,{Z:function(){return j}});var s=n(5893),o=n(7294),i=n(1163),a=n(9008),r=n.n(a),l=n(3946),c=n(8849),u=n(5317),d=n(8298),p=n(2734),m=n(2293),h=n(5582),y=n(155),x=n(6886),g=n(3321),v=n(5861),b=n(7357);function k(e){let{children:t}=e,n=(0,d.Z)({disableHysteresis:!0,threshold:24});return(0,o.cloneElement)(t,{elevation:n?4:0})}var f=function(){let[e,t]=(0,o.useState)(!1);(0,o.useCallback)(()=>{t(!e)},[e]);let n=(0,p.Z)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(k,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{color:"transparent",elevation:0,children:(0,s.jsx)(h.Z,{maxWidth:"xl",sx:{padding:0},children:(0,s.jsx)(y.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,s.jsx)(x.ZP,{item:!0,children:(0,s.jsx)(g.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,s.jsx)(v.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:n.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,s.jsx)(b.Z,{sx:{height:n.spacing(18)}})]})})})};let w=!1;var j=function(e){let t=(0,i.useRouter)();return(0,o.useEffect)(()=>{if(t.isReady&&!w){var e,n,s,o;w=!0;let i=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",a=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",r=!1;if((null===(s=t.query)||void 0===s?void 0:s.apiKey)||(r=!0,i=window.prompt("Please enter your API key",i)),(null===(o=t.query)||void 0===o?void 0:o.apiPort)||(r=!0,a=window.prompt("Please enter your API port (default: 9170)",a)),r&&i&&a){let e=t.asPath.split("?")[0];t.replace({pathname:e.includes(".html")?e:"".concat(e,".html"),query:{...t.query,apiKey:i,apiPort:a}})}}},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,s.jsx)("link",{rel:"canonical",href:e.url}),(0,s.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,s.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,s.jsx)(f,{}),e.closeButton&&(0,s.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:()=>{window.location.href="http://close.window"},children:(0,s.jsx)(c.Icon,{id:"close",path:u.r5M,size:1})}),e.children]})}},8995:function(e,t,n){n.d(t,{D:function(){return i},X:function(){return o}});var s=n(7294);function o(e){navigator.permissions.query({name:"clipboard-write"}).then(t=>{("granted"===t.state||"prompt"===t.state)&&navigator.clipboard.writeText(e)})}function i(e){let t=(0,s.useRef)();return(0,s.useEffect)(()=>{t.current=e}),t.current}},6018:function(e,t,n){n.d(t,{C:function(){return s}});class s{close(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()}async connect(){let e=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(this.port,"/api/websocket"));return await new Promise(t=>{e.onopen=()=>t()}),e.onmessage=e=>{if("string"==typeof e.data){let t=JSON.parse(e.data);t&&this.onEvent&&this.onEvent(t)}},e}isConnected(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}getData(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_DATA",modules:e})))}getSettings(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_SETTINGS"})))}registerDataListener(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"REGISTER_DATA_LISTENER",modules:e})))}sendPlayerStatus(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"MEDIA_STATUS",status:e}))}updateSetting(e,t){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",{key:e,value:t}),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"UPDATE_SETTING",setting:e,value:t})))}constructor(e,t,n){this.port=e||9170,this.apiKey=t,(async()=>{this.websocket=await this.connect(),n&&this.websocket&&this.websocket.readyState===this.websocket.OPEN&&n()})()}}},630:function(e,t,n){let s;n.d(t,{Z:function(){return E}});var o=n(5893),i=n(7294),a=n(6885),r=n(6486),l=n(8096),c=n(8995),u=n(6018),d=n(2734),p=n(6886),m=n(7357),h=n(2022),y=n(6628),x=n(5861),g=n(3946),v=n(3754),b=n(8849),k=n(5317),f=n(381),w=n.n(f),j=n(6310),S=function(){let[e,t]=(0,l.nn)(),[n,s]=(0,i.useState)(!1),[a,r]=(0,l.XI)(),c=(0,i.useRef)(null),{duration:u,playing:f,muted:S,loaded:P,position:E,volume:C}=(0,i.useMemo)(()=>e,[e]),Z=(0,i.useMemo)(()=>"".concat((100*C).toFixed(0),"%"),[C]),I=(0,i.useMemo)(()=>{let e=w().duration(E,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[E]),D=(0,i.useMemo)(()=>{let e=w().duration(u,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[u]),{artist:M,album:N,cover:_,source:A,title:O}=(0,i.useMemo)(()=>e.source,[e]),T=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),L=(0,i.useCallback)(n=>{t({...e,playing:n})},[e,t]),U=(0,i.useCallback)(()=>{L(!f)},[f,L]),K=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]),R=(0,i.useCallback)(()=>{K(!S)},[S,K]),W=(0,i.useCallback)((n,s)=>{let o="down"===s?C-n:"up"===s?C+n:n;o>1&&(o=1),o<0&&(o=0),t({...e,volume:o}),S&&K(!1)},[S,C,e,t,K]),q=(0,i.useCallback)(n=>{t({...e,duration:n})},[e,t]),z=(0,i.useCallback)(n=>{u&&n>u&&(n=u),n<0&&(n=0),t({...e,position:n})},[e,u,t]),F=(0,i.useCallback)(e=>{var t;null===(t=c.current)||void 0===t||t.seekTo(e,"seconds"),s(!1),f||L(!0)},[f,L]);function G(){L(!1),s(!0)}function B(){E&&F(E)}(0,i.useEffect)(()=>{P||T(!0)},[P,T,L]);let J=(0,d.Z)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.Z,{ref:c,height:"0px",width:"0px",muted:S,playing:f,stopOnUnmount:!0,url:A,volume:C,onDuration:e=>{q(e)},onPause:()=>{L(!1)},onPlay:()=>{L(!0)},onStart:()=>{L(!0)},onProgress:e=>{let{playedSeconds:t}=e;n||z(t)}}),(0,o.jsxs)(p.ZP,{container:!0,direction:"row",alignItems:"center",justifyItems:"center",wrap:"nowrap",sx:{height:140,width:540,overflow:"hidden"},children:[(0,o.jsx)(p.ZP,{item:!0,sx:{width:140,margin:J.spacing(0,1,0,0)},children:(0,o.jsx)(m.Z,{ref:a,children:(0,o.jsxs)(h.Z,{"aria-label":f?"Pause":"Play",onClick:U,children:[(0,o.jsx)("img",{alt:"".concat(M," - ").concat(N),src:_||"https://raw.githubusercontent.com/timmo001/system-bridge/master/resources/system-bridge-dimmed.svg",width:140}),(0,o.jsx)(y.Z,{in:!!r,timeout:{enter:200,exit:400},children:(0,o.jsx)(m.Z,{sx:{position:"absolute",display:"flex",height:"100%",width:"100%",zIndex:100},children:(0,o.jsx)(b.Icon,{id:f?"pause":"play",path:f?k.Wa1:k._86,size:6,style:{position:"relative",margin:"auto"}})})})]})})}),(0,o.jsx)(p.ZP,{item:!0,xs:!0,children:(0,o.jsxs)(p.ZP,{container:!0,direction:"column",alignItems:"flex-start",justifyItems:"space-around",children:[(0,o.jsx)(p.ZP,{item:!0,children:(0,o.jsxs)(x.Z,{color:"textPrimary",component:"span",variant:"subtitle1",noWrap:!0,children:[M," - ",O]})}),(0,o.jsx)(p.ZP,{item:!0,children:(0,o.jsx)(x.Z,{color:"textSecondary",component:"span",variant:"subtitle2",noWrap:!0,children:N})}),(0,o.jsxs)(p.ZP,{item:!0,container:!0,alignContent:"center",children:[(0,o.jsx)(p.ZP,{item:!0,xs:4}),(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(0,1,0,0)},item:!0,children:(0,o.jsx)(g.Z,{size:"small",onClick:R,children:S?(0,o.jsx)(b.Icon,{id:"mute",path:k.PLS,size:1.25}):(0,o.jsx)(b.Icon,{id:"unmute",path:k.dw,size:1.25})})}),(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(.6,2,0,0)},item:!0,xs:!0,children:(0,o.jsx)(v.ZP,{min:0,max:1,step:.01,value:C,onChange:(e,t)=>{"number"==typeof t&&W(t)}})}),(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(.9,C>=1?1:2,0,0)},item:!0,children:(0,o.jsx)(x.Z,{component:"span",variant:"body2",children:Z})})]}),(0,o.jsxs)(p.ZP,{container:!0,children:[(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(.25,2,0,0)},item:!0,children:(0,o.jsx)(x.Z,{component:"span",variant:"body2",children:I})}),(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(0,2,0,0)},item:!0,xs:!0,children:(0,o.jsx)(v.ZP,{min:0,max:u,step:.1,value:E,valueLabelDisplay:"off",onMouseDown:G,onKeyDown:G,onChange:function(e,t){z(t)},onMouseUp:B,onKeyUp:B})}),(0,o.jsx)(p.ZP,{sx:{margin:J.spacing(.25,1,0,0)},item:!0,children:(0,o.jsx)(x.Z,{component:"span",variant:"body2",children:D})})]})]})})]})]})},P=function(){let[e,t]=(0,l.nn)(),{autoplay:n,duration:s,playing:a,muted:r,loaded:c,volume:u}=(0,i.useMemo)(()=>e,[e]),{source:d}=(0,i.useMemo)(()=>e.source,[e]),p=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),m=(0,i.useCallback)(n=>{console.log("Set playing:",n),t({...e,playing:n})},[e,t]),h=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]);(0,i.useCallback)((n,s)=>{let o="down"===s?u-n:"up"===s?u+n:n;o>1&&(o=1),o<0&&(o=0),t({...e,volume:o}),r&&h(!1)},[r,u,e,t,h]);let y=(0,i.useCallback)(n=>t({...e,duration:n}),[e,t]),x=(0,i.useCallback)(n=>{s&&n>s&&(n=s),n<0&&(n=0),t({...e,position:n})},[e,s,t]);return(0,i.useEffect)(()=>{c||p(!0)},[c,p]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(j.Z,{autoPlay:n,controls:!0,height:"270px",width:"480px",playsinline:!0,muted:r,playing:a,url:d,volume:u,style:{position:"absolute",top:"0",left:"0",overflow:"hidden"},onReady:()=>{console.log("Autoplay:",n),m(n||!1)},onDuration:e=>y(e),onPause:()=>m(!1),onPlay:()=>m(!0),onStart:()=>m(!0),onProgress:e=>{let{playedSeconds:t}=e;return x(t)}})})},E=function(e){let{playerType:t}=e,[n,d]=(0,i.useState)(!1),[p,m]=(0,l.nn)(),h=(0,c.D)(p),y=(0,a.useRouter)(),x=y.query,g=(0,i.useCallback)(e=>{switch(console.log("Event:",e),e.type){case"MEDIA_PAUSE":m({...p,playing:!1});break;case"MEDIA_PLAY":m({...p,playing:!0});break;case"MEDIA_VOLUME_DOWN":e.volume&&m({...p,volume:p.volume-e.volume});break;case"MEDIA_VOLUME_UP":e.volume&&m({...p,volume:p.volume+e.volume});break;case"MEDIA_VOLUME_SET":e.volume&&m({...p,volume:e.volume});break;case"MEDIA_VOLUME_SET":e.position&&m({...p,position:e.position})}},[p,m]),v=(0,i.useCallback)((e,t)=>{console.log("Setup WebSocketConnection"),(s=new u.C(e,t,async()=>{console.log("Connected to WebSocket")})).onEvent=g},[g]);(0,i.useEffect)(()=>{!n&&x&&x.apiKey&&(d(!0),v(Number(x.apiPort)||9170,String(x.apiKey)))},[n,v,x]),(0,i.useEffect)(()=>{if(!p&&y.isReady){var e,n;let s=Number(x.volume);switch(t){default:break;case"audio":m({autoplay:(null===(e=x.autoplay)||void 0===e?void 0:e.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"audio",source:x.url,album:x.album||"Unknown Album",artist:x.artist||"Unknown Aritst",cover:x.cover,title:x.title||"Unknown Title",volumeInitial:(s>0?s:40)/100},volume:(s>0?s:40)/100});break;case"video":m({autoplay:(null===(n=x.autoplay)||void 0===n?void 0:n.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"video",source:String(x.url),volumeInitial:(s>0?s:40)/100},volume:(s>0?s:40)/100})}}},[p,m,t,y,x]),(0,i.useEffect)(()=>{if(p){let e;h&&"audio"===(e=(0,r.cloneDeep)(h)).source.type&&delete e.source.cover;let t=(0,r.cloneDeep)(p);if("audio"===t.source.type&&delete t.source.cover,!(0,r.isEqual)(t,e)){if(console.log("Player update\n\npreviousStatus:",e,"\nnewStatus:",t),!t.loaded||!s)return;if(!s.isConnected()){d(!1),console.warn("WebSocket not connected");return}s.sendPlayerStatus(t)}}},[p,h]);let b=(0,i.useMemo)(()=>{if(p)return p.source.type},[p]);return(0,o.jsx)(o.Fragment,{children:"audio"===b?(0,o.jsx)(S,{}):"video"===b?(0,o.jsx)(P,{}):""})}},8096:function(e,t,n){n.d(t,{I0:function(){return r},XI:function(){return c},nn:function(){return l}});var s=n(5893),o=n(7294);let i=(0,o.createContext)(void 0),a=(0,o.createContext)(null),r=e=>{let{children:t}=e,[n,r]=(0,o.useState)();return(0,s.jsx)(a.Provider,{value:r,children:(0,s.jsx)(i.Provider,{value:n,children:t})})},l=()=>{let e=(0,o.useContext)(i),t=(0,o.useContext)(a);if(null===t)throw Error();return[e,t]};function c(){let[e,t]=o.useState(!1),n=o.useCallback(()=>t(!0),[]),s=o.useCallback(()=>t(!1),[]),i=o.useRef(),a=o.useCallback(e=>{i.current&&(i.current.removeEventListener("mouseover",n),i.current.removeEventListener("mouseout",s)),i.current=e,i.current&&(i.current.addEventListener("mouseover",n),i.current.addEventListener("mouseout",s))},[n,s]);return[a,e]}}}]);