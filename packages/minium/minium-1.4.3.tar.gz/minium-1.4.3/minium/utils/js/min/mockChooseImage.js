function mockChooseImage(){let e=wx.getFileSystemManager();if(!global.__minium_mock_choose_image){let i=new Map,a=new Map;function t(){a.forEach((e=>{e()}))}function s(e,s){if(i.get(e))return!1;i.set(e,!0);const r={},c={},o={chooseImage(e){t();const i={errMsg:"chooseImage:ok",tempFilePaths:s.map((e=>e.filePath)),tempFiles:s.map((e=>({path:e.filePath,size:e.size})))};if(!e.success&&!e.fail&&!e.complete)return Promise.resolve(i);e.success&&e.success(i),e.complete&&e.complete(i)},chooseMedia(e){t();const i={errMsg:"chooseMedia:ok",tempFiles:s.map((e=>({tempFilePath:e.filePath,size:e.size,fileType:"image"}))),type:"image"};if(!e.success&&!e.fail&&!e.complete)return Promise.resolve(i);e.success&&e.success(i),e.complete&&e.complete(i)},createCameraContext(){const a=r.createCameraContext(),c=a.takePhoto;return Object.defineProperty(a,"takePhoto",{configurable:!0,get:()=>function(a){if(!i.get(e))return c.call(this,a);t();const r={tempImagePath:s[0].filePath,errMsg:"takePhoto:ok"};a.success&&a.success(r),a.complete&&a.complete(r)}}),a}},l=Object.keys(o);return l.forEach((t=>{r[t]=e[t],c[t]=Object.getOwnPropertyDescriptor(e,t)})),a.set(e,(function(){i.get(e)&&(console.debug("release target"),i.set(e,!1),l.forEach((t=>{c[t]?c[t].get?Object.defineProperty(e,t,{configurable:!0,get:()=>r[t]}):Object.defineProperty(e,t,{writable:!0,value:r[t]}):e[t]=r[t]})))})),l.forEach((t=>{c[t]?c[t].get?Object.defineProperty(e,t,{configurable:!0,get:()=>o[t]}):Object.defineProperty(e,t,{writable:!0,value:o[t]}):e[t]=o[t]})),!0}global.__minium_mock_choose_image=function(...t){const i=t.map((t=>{const{imageData:s,imageName:i,size:a}=t,r=`${wx.env.USER_DATA_PATH}/.MINIUM_TMP/${i}`;return s&&0!==s.length?new Promise(((t,a)=>{e.writeFile({filePath:r,data:s,encoding:"base64",success:()=>{e.stat({path:r,success:({stats:e})=>{t({imageName:i,filePath:r,size:e.size})}})},fail:({errMsg:e})=>{a("writeFile:fail the maximum size of the file storage limit is exceeded"===e?new Error("小程序文件空间不足"):"writeFile:fail sdcard not mounted"===e?new Error("sdcard未挂载"):new Error(`Mock失败: ${e}`))}})})):Promise.resolve({imageName:i,filePath:r,size:a})}));return Promise.all(i).then((e=>(s(wx,e),wx._MINI_WX_PROXY_&&s(wx._MINI_WX_PROXY_,e),e.map((e=>({name:e.imageName,size:e.size}))))))};let r=!1;e.mkdir({dirPath:`${wx.env.USER_DATA_PATH}/.MINIUM_STORE`,recursive:!1,success(){r=!0},fail:({errMsg:e})=>{e.indexOf("file already exists")>=0&&(r=!0)}});const c=e.saveFile,o=e.saveFileSync,l=e.getSavedFileList;Object.defineProperty(e,"saveFile",{configurable:!0,get:()=>function({tempFilePath:t,filePath:s,success:i,fail:a,complete:r}){if(t.startsWith(`${wx.env.USER_DATA_PATH}/.MINIUM_TMP`)){const c={srcPath:t,destPath:s||`${wx.env.USER_DATA_PATH}/.MINIUM_STORE/${t.split("/").pop()}`};return i&&(c.success=e=>{e.errMsg=e.errMsg.replace("copyFile","saveFile"),e.savedFilePath=c.destPath,i(e)}),a&&(c.fail=e=>{e.errMsg=e.errMsg.replace("copyFile","saveFile"),a(e)}),r&&(c.complete=e=>{e.errMsg=e.errMsg.replace("copyFile","saveFile"),0===e.errMsg.indexOf("saveFile:ok")&&(e.savedFilePath=c.destPath),r(e)}),e.copyFile(c)}return c({tempFilePath:t,filePath:s,success:i,fail:a,complete:r})}}),Object.defineProperty(e,"saveFileSync",{configurable:!0,get:()=>function(t,s){if(t.startsWith(`${wx.env.USER_DATA_PATH}/.MINIUM_TMP`)){const i=t,a=s||`${wx.env.USER_DATA_PATH}/.MINIUM_STORE/${t.split("/").pop()}`;try{return e.copyFileSync(i,a),a}catch(e){throw e.message.replace("copyFileSync","saveFileSync")}}return o(t,s)}}),Object.defineProperty(e,"getSavedFileList",{configurable:!0,get:()=>function({success:t,complete:s}){Promise.all([new Promise((t=>{e.stat({path:`${wx.env.USER_DATA_PATH}/.MINIUM_STORE/`,recursive:!0,complete:e=>{t((e.stats||[]).filter((e=>"/"!==e.path)).map((e=>({filePath:`${wx.env.USER_DATA_PATH}/.MINIUM_STORE/${e.path.startsWith("/")?e.path.slice(1):e.path}`,size:e.stats.size,createTime:e.stats.lastModifiedTime}))))}})})),new Promise((e=>{l({complete:t=>{e(t.fileList||[])}})}))]).then((([e,i])=>{const a={fileList:e.concat(i),errMsg:"getSavedFileList:ok"};t&&t(a),s&&s(a)}))}})}return new Promise(((t,s)=>{e.mkdir({dirPath:`${wx.env.USER_DATA_PATH}/.MINIUM_TMP`,recursive:!1,success(){t([])},fail:({errMsg:i})=>{i.indexOf("file already exists")>=0?e.stat({path:`${wx.env.USER_DATA_PATH}/.MINIUM_TMP/`,recursive:!0,success:e=>{if(console.warn("[debug]fs.stat success"),!e.stats.length)return t([]);t(e.stats.map((e=>({name:e.path.replace(/^\//,""),size:e.stats.size}))).filter((e=>e.name)))},fail:s}):s({errMsg:i})}})}))}
